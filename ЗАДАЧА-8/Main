package obfuscator;

import java.io.*;
import java.nio.file.*;
import java.util.Scanner;

/**
 * –ì–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –æ–±—Ñ—É—Å–∫–∞—Ç–æ—Ä–∞ Java-–∫–æ–¥–∞
 * –ü–æ–¥–∑–∞–¥–∞—á–∏:
 * 1. –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–∏–º–≤–æ–ª–æ–≤ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
 * 2. –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
 * 3. –ó–∞–º–µ–Ω–∞ –∏–º–µ–Ω–∏ –∫–ª–∞—Å—Å–∞, –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤
 * 4. –ó–∞–º–µ–Ω–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –Ω–∞ –æ–¥–Ω–æ—Å–∏–º–≤–æ–ª—å–Ω—ã–µ –∏–ª–∏ –¥–≤—É—Ö—Å–∏–º–≤–æ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞
 */
public class Main {
    public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);

        System.out.println("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        System.out.println("‚ïë           JAVA –ö–û–î –û–ë–§–£–°–ö–ê–¢–û–† v1.0               ‚ïë");
        System.out.println("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
        System.out.println();

        try {
            // –®–ê–ì 1: –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            System.out.print("üìÅ –í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å Java-—Ñ–∞–π–ª–∞–º–∏: ");
            String directoryPath = scanner.nextLine().trim();

            // –ï—Å–ª–∏ –ø—É—Ç—å –ø—É—Å—Ç–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
            if (directoryPath.isEmpty()) {
                directoryPath = ".";
                System.out.println("‚ö†Ô∏è  –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: " + new File(".").getAbsolutePath());
            }

            File directory = new File(directoryPath);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            if (!directory.exists() || !directory.isDirectory()) {
                System.err.println("‚ùå –û—à–∏–±–∫–∞: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —ç—Ç–æ –Ω–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è!");
                return;
            }

            // –®–ê–ì 2: –ò—â–µ–º Java-—Ñ–∞–π–ª—ã
            System.out.println("\nüîç –ò—â–µ–º —Ñ–∞–π–ª—ã —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º .java...");
            File[] javaFiles = directory.listFiles((dir, name) -> name.toLowerCase().endsWith(".java"));

            if (javaFiles == null || javaFiles.length == 0) {
                System.err.println("‚ùå Java-—Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏!");
                return;
            }

            System.out.println("‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: " + javaFiles.length);

            // –®–ê–ì 3: –°–æ–∑–¥–∞–µ–º –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
            Path outputDir = Paths.get(directoryPath, "obfuscated");
            Files.createDirectories(outputDir);
            System.out.println("üìÇ –°–æ–∑–¥–∞–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: " + outputDir);

            // –®–ê–ì 4: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
            System.out.println("\n‚öôÔ∏è  –ù–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ–∞–π–ª–æ–≤:");
            System.out.println("‚ïê".repeat(50));

            Obfuscator obfuscator = new Obfuscator();

            for (File javaFile : javaFiles) {
                System.out.println("\nüìÑ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª: " + javaFile.getName());
                System.out.println("   üìç –ü—É—Ç—å: " + javaFile.getAbsolutePath());

                try {
                    // –ß–∏—Ç–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª
                    String originalContent = new String(Files.readAllBytes(javaFile.toPath()));
                    System.out.println("   üìä –†–∞–∑–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞: " + originalContent.length() + " —Å–∏–º–≤–æ–ª–æ–≤");

                    // –û–±—Ñ—É—Å—Ü–∏—Ä—É–µ–º –∫–æ–¥
                    String obfuscatedContent = obfuscator.obfuscate(originalContent, javaFile.getName());

                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                    String outputFileName = javaFile.getName().replace(".java", "_obf.java");
                    Path outputPath = outputDir.resolve(outputFileName);

                    Files.write(outputPath, obfuscatedContent.getBytes());

                    System.out.println("   ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω: " + outputFileName);
                    System.out.println("   üìä –†–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ –æ–±—Ñ—É—Å–∫–∞—Ü–∏–∏: " + obfuscatedContent.length() + " —Å–∏–º–≤–æ–ª–æ–≤");

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–∂–∞—Ç–∏—è
                    double compressionRatio = 100.0 - (obfuscatedContent.length() * 100.0 / originalContent.length());
                    System.out.printf("   üìà –°–∂–∞—Ç–∏–µ: %.1f%%\n", compressionRatio);

                } catch (Exception e) {
                    System.err.println("   ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: " + e.getMessage());
                }
            }

            // –®–ê–ì 5: –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            System.out.println("\n" + "‚ïê".repeat(50));
            System.out.println("üéâ –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–í–ï–†–®–ï–ù–ê!");
            System.out.println("üìÅ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤: " + outputDir.toAbsolutePath());
            System.out.println("\nüí° –°–æ–≤–µ—Ç—ã:");
            System.out.println("   1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—Ñ—É—Å—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º");
            System.out.println("   2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å");
            System.out.println("   3. –î–ª—è –∫–ª–∞—Å—Å–æ–≤ —Å main-–º–µ—Ç–æ–¥–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø—É—Å–∫");

        } catch (Exception e) {
            System.err.println("\n‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: " + e.getMessage());
            e.printStackTrace();
        } finally {
            scanner.close();
        }
    }
}
